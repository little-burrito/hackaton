<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>A Simple Map</title>

<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
<script src='libraries/mapbox/mapbox.js'></script>
<link href='libraries/mapbox/mapbox.css' rel='stylesheet' />

<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>

<div id='map'></div>

<script src="maps.js">
    function markerrender ( )
    {
        if (navigator.geolocation) {
            map.locate();
            map.markerLayer.setGeoJSON(geoJson);
            map.fitBounds(map.markerLayer.getBounds());
        }
        setTimeout(markerrender, 1000);
    };
    markerrender();



    // Once we've got a position, zoom and center the map
    // on it, and add a single marker.
    map.on('locationfound', function(e) {
        map.fitBounds(e.bounds);
        var geoJson = {
            type: 'FeatureCollection',
            features: [
                {type: "Feature",
                    geometry: {
                        type: "Point",
                        coordinates: [e.latlng.lng, e.latlng.lat]
                    },
                    properties: {
                        'marker-color': '#000',
                        'marker-symbol': 'star-stroked'
                    }
                },
                {
                    type: 'Feature',
                    properties: {
                        title: 'Washington, D.C.',
                        'marker-color': '#f00',
                        'marker-size': 'large',
                        url: 'http://en.wikipedia.org/wiki/Washington,_D.C.'
                    },
                    geometry: {
                        type: 'Point',
                        coordinates: [e.latlng.lng + 0.001, e.latlng.lat +0.001]
                    }
                },
                {
                    type: 'Feature',
                    properties: {
                        "title": "Small astronaut",
                        'marker-color': '#f10',
                        'marker-size': 'large',
                        url: 'http://en.wikipedia.org/wiki/Baltimore'
                    },
                    geometry: {
                        type: 'Point',
                        coordinates: [e.latlng.lng+0.001, e.latlng.lat -0.001]
                    }
                }]
        };
        map.markerLayer.on('click', function(e) {
            e.layer.unbindPopup();
            window.open(e.layer.feature.properties.url);
        });
        heat = L.heatLayer(geoJson, {maxZoom: 18}).addTo(map);
        map.addLayer(heat);
        draw = true;
    });


    // If the user chooses not to allow their location
    // to be shared, display an error message.
    map.on('locationerror', function() {
        geolocate.innerHTML = 'position could not be found';
    });


</script>


</body>
</html>